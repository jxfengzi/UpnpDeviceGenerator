/* Automatic generated by DeviceToC */

#include "tiny_memory.h"
#include "tiny_str_equal.h"
#include "tiny_log.h"
#include "UpnpServiceHelper.h"
#include "BleOperation.h"

#define TAG             "BleOperation"

static const char * _SERVICE_TYPE = "urn:schemas-upnp-org:service:BleOperation:0.1";

//-------------------------------------------------------
// Action Names (10)
//-------------------------------------------------------
static const char * ACTION_StartScan = "StartScan";
static const char * _StartScan_ARG_Fileter = "Fileter";
static const char * ACTION_WriteCharacteristic = "WriteCharacteristic";
static const char * _WriteCharacteristic_ARG_BleDevice = "BleDevice";
static const char * _WriteCharacteristic_ARG_BleService = "BleService";
static const char * _WriteCharacteristic_ARG_BleCharacteristic = "BleCharacteristic";
static const char * _WriteCharacteristic_ARG_Data = "Data";
static const char * ACTION_KeepAlive = "KeepAlive";
static const char * _KeepAlive_ARG_BleDevice = "BleDevice";
static const char * ACTION_DiscoverServices = "DiscoverServices";
static const char * _DiscoverServices_ARG_BleDevice = "BleDevice";
static const char * ACTION_EnableCharacteristicNotification = "EnableCharacteristicNotification";
static const char * _EnableCharacteristicNotification_ARG_BleDevice = "BleDevice";
static const char * _EnableCharacteristicNotification_ARG_BleService = "BleService";
static const char * _EnableCharacteristicNotification_ARG_BleCharacteristic = "BleCharacteristic";
static const char * ACTION_ReadCharacteristic = "ReadCharacteristic";
static const char * _ReadCharacteristic_ARG_BleDevice = "BleDevice";
static const char * _ReadCharacteristic_ARG_BleService = "BleService";
static const char * _ReadCharacteristic_ARG_BleCharacteristic = "BleCharacteristic";
static const char * ACTION_getConnectedDevices = "getConnectedDevices";
static const char * _getConnectedDevices_ARG_RetAvaliableDevices = "RetAvaliableDevices";
static const char * ACTION_getAvaliableDevices = "getAvaliableDevices";
static const char * _getAvaliableDevices_ARG_RetAvaliableDevices = "RetAvaliableDevices";
static const char * ACTION_StopScan = "StopScan";
static const char * ACTION_DisableCharacteristicNotification = "DisableCharacteristicNotification";
static const char * _DisableCharacteristicNotification_ARG_BleDevice = "BleDevice";
static const char * _DisableCharacteristicNotification_ARG_BleService = "BleService";
static const char * _DisableCharacteristicNotification_ARG_BleCharacteristic = "BleCharacteristic";

//-------------------------------------------------------
// Property Name (11)
//-------------------------------------------------------
static const char * PROPERTY_CharacteristicReaded = "CharacteristicReaded";
static const char * PROPERTY_A_ARG_TYPE_BleCharacteristic = "A_ARG_TYPE_BleCharacteristic";
static const char * PROPERTY_A_ARG_TYPE_BleService = "A_ARG_TYPE_BleService";
static const char * PROPERTY_A_ARG_TYPE_BleDevices = "A_ARG_TYPE_BleDevices";
static const char * PROPERTY_ScanResult = "ScanResult";
static const char * PROPERTY_CharacteristicNotified = "CharacteristicNotified";
static const char * PROPERTY_A_ARG_TYPE_BleDevice = "A_ARG_TYPE_BleDevice";
static const char * PROPERTY_A_ARG_TYPE_Filter = "A_ARG_TYPE_Filter";
static const char * PROPERTY_CharacteristicWrited = "CharacteristicWrited";
static const char * PROPERTY_A_ARG_TYPE_Data = "A_ARG_TYPE_Data";
static const char * PROPERTY_DiscoveredServices = "DiscoveredServices";

//-------------------------------------------------------
// Property value defined (0)
//-------------------------------------------------------


static TinyRet BleOperation_Construct(BleOperation *thiz, UpnpDevice *device, UpnpRuntime *runtime);
static void BleOperation_Dispose(BleOperation *thiz);

static TinyRet init_service(BleOperation *thiz, UpnpDevice *device);
static TinyRet init_stateList(UpnpService *service);
static TinyRet init_actionList(UpnpService *service);

static UpnpCode handle_StartScan(BleOperation *thiz, UpnpAction *action);
static UpnpCode handle_WriteCharacteristic(BleOperation *thiz, UpnpAction *action);
static UpnpCode handle_KeepAlive(BleOperation *thiz, UpnpAction *action);
static UpnpCode handle_DiscoverServices(BleOperation *thiz, UpnpAction *action);
static UpnpCode handle_EnableCharacteristicNotification(BleOperation *thiz, UpnpAction *action);
static UpnpCode handle_ReadCharacteristic(BleOperation *thiz, UpnpAction *action);
static UpnpCode handle_getConnectedDevices(BleOperation *thiz, UpnpAction *action);
static UpnpCode handle_getAvaliableDevices(BleOperation *thiz, UpnpAction *action);
static UpnpCode handle_StopScan(BleOperation *thiz, UpnpAction *action);
static UpnpCode handle_DisableCharacteristicNotification(BleOperation *thiz, UpnpAction *action);

struct _BleOperation {
    UpnpRuntime *runtime;
    UpnpService *service;
    BleOperation_OnStartScan OnStartScan;
    BleOperation_OnWriteCharacteristic OnWriteCharacteristic;
    BleOperation_OnKeepAlive OnKeepAlive;
    BleOperation_OnDiscoverServices OnDiscoverServices;
    BleOperation_OnEnableCharacteristicNotification OnEnableCharacteristicNotification;
    BleOperation_OnReadCharacteristic OnReadCharacteristic;
    BleOperation_OngetConnectedDevices OngetConnectedDevices;
    BleOperation_OngetAvaliableDevices OngetAvaliableDevices;
    BleOperation_OnStopScan OnStopScan;
    BleOperation_OnDisableCharacteristicNotification OnDisableCharacteristicNotification;
    void *ctx;
};

BleOperation * BleOperation_Create(UpnpDevice *device, UpnpRuntime *runtime) {
    BleOperation * thiz = NULL;

    RETURN_VAL_IF_FAIL(device, NULL);
    RETURN_VAL_IF_FAIL(runtime, NULL);

    do {
        thiz = (BleOperation *)tiny_malloc(sizeof(BleOperation));
        if (thiz == NULL) {
            LOG_E(TAG, "OUT OF MEMORY!");
            break;
        }
        if (RET_FAILED(BleOperation_Construct(thiz, device, runtime))) {
            LOG_E(TAG, "BleOperation_Construct failed");
            BleOperation_Delete(thiz);
            thiz = NULL;
            break;
        }
    } while (0);

    return thiz;
}

static TinyRet BleOperation_Construct(BleOperation *thiz, UpnpDevice *device, UpnpRuntime *runtime) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        memset(thiz, 0, sizeof(BleOperation));
        thiz->runtime = runtime;
        thiz->OnStartScan = NULL;
        thiz->OnWriteCharacteristic = NULL;
        thiz->OnKeepAlive = NULL;
        thiz->OnDiscoverServices = NULL;
        thiz->OnEnableCharacteristicNotification = NULL;
        thiz->OnReadCharacteristic = NULL;
        thiz->OngetConnectedDevices = NULL;
        thiz->OngetAvaliableDevices = NULL;
        thiz->OnStopScan = NULL;
        thiz->OnDisableCharacteristicNotification = NULL;
        thiz->ctx = NULL;

        ret = init_service(thiz, device);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    return ret;
}

static void BleOperation_Dispose(BleOperation *thiz) {
    RETURN_IF_FAIL(thiz);

    /**
     * DO NOT delete thiz->service !!!
     */
}

void BleOperation_Delete(BleOperation *thiz) {
    RETURN_IF_FAIL(thiz);

    BleOperation_Dispose(thiz);
    tiny_free(thiz);
}

static TinyRet init_service(BleOperation *thiz, UpnpDevice *device) {
    TinyRet ret = TINY_RET_OK;

    do {
        thiz->service = UpnpService_New();
        if (thiz->service == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        UpnpService_SetParentDevice(thiz->service, device);
        UpnpService_SetServiceType(thiz->service, _SERVICE_TYPE);

        ret = UpnpServiceHelper_UpdateServiceId(thiz->service);
        if (RET_FAILED(ret)) {
            UpnpService_Delete(thiz->service);
            thiz->service = NULL;
            break;
        }

        ret = UpnpServiceHelper_UpdateScpdUrl(thiz->service);
        if (RET_FAILED(ret)) {
            UpnpService_Delete(thiz->service);
            thiz->service = NULL;
            break;
        }

        ret = UpnpServiceHelper_UpdateCtrlUrl(thiz->service);
        if (RET_FAILED(ret)) {
            UpnpService_Delete(thiz->service);
            thiz->service = NULL;
            break;
        }

        ret = UpnpServiceHelper_UpdateEventUrl(thiz->service);
        if (RET_FAILED(ret)) {
            UpnpService_Delete(thiz->service);
            thiz->service = NULL;
            break;
        }

        ret = init_stateList(thiz->service);
        if (RET_FAILED(ret)) {
            UpnpService_Delete(thiz->service);
            thiz->service = NULL;
            break;
        }

        ret = init_actionList(thiz->service);
        if (RET_FAILED(ret)) {
            UpnpService_Delete(thiz->service);
            thiz->service = NULL;
            break;
        }

        ret = UpnpDevice_AddService(device, thiz->service);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    return ret;
}

static TinyRet init_stateList(UpnpService *service) {
    TinyRet ret = TINY_RET_OK;

    do {
        UpnpStateVariable * _CharacteristicReaded = UpnpStateVariable_New();
        if (_CharacteristicReaded == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_CharacteristicReaded, PROPERTY_CharacteristicReaded, "string", NULL, "YES");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _CharacteristicReaded);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _A_ARG_TYPE_BleCharacteristic = UpnpStateVariable_New();
        if (_A_ARG_TYPE_BleCharacteristic == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_A_ARG_TYPE_BleCharacteristic, PROPERTY_A_ARG_TYPE_BleCharacteristic, "string", NULL, "NO");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _A_ARG_TYPE_BleCharacteristic);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _A_ARG_TYPE_BleService = UpnpStateVariable_New();
        if (_A_ARG_TYPE_BleService == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_A_ARG_TYPE_BleService, PROPERTY_A_ARG_TYPE_BleService, "string", NULL, "NO");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _A_ARG_TYPE_BleService);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _A_ARG_TYPE_BleDevices = UpnpStateVariable_New();
        if (_A_ARG_TYPE_BleDevices == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_A_ARG_TYPE_BleDevices, PROPERTY_A_ARG_TYPE_BleDevices, "string", NULL, "NO");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _A_ARG_TYPE_BleDevices);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _ScanResult = UpnpStateVariable_New();
        if (_ScanResult == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_ScanResult, PROPERTY_ScanResult, "string", NULL, "YES");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _ScanResult);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _CharacteristicNotified = UpnpStateVariable_New();
        if (_CharacteristicNotified == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_CharacteristicNotified, PROPERTY_CharacteristicNotified, "string", NULL, "YES");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _CharacteristicNotified);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _A_ARG_TYPE_BleDevice = UpnpStateVariable_New();
        if (_A_ARG_TYPE_BleDevice == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_A_ARG_TYPE_BleDevice, PROPERTY_A_ARG_TYPE_BleDevice, "string", NULL, "NO");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _A_ARG_TYPE_BleDevice);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _A_ARG_TYPE_Filter = UpnpStateVariable_New();
        if (_A_ARG_TYPE_Filter == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_A_ARG_TYPE_Filter, PROPERTY_A_ARG_TYPE_Filter, "string", NULL, "NO");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _A_ARG_TYPE_Filter);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _CharacteristicWrited = UpnpStateVariable_New();
        if (_CharacteristicWrited == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_CharacteristicWrited, PROPERTY_CharacteristicWrited, "string", NULL, "YES");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _CharacteristicWrited);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _A_ARG_TYPE_Data = UpnpStateVariable_New();
        if (_A_ARG_TYPE_Data == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_A_ARG_TYPE_Data, PROPERTY_A_ARG_TYPE_Data, "string", NULL, "NO");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _A_ARG_TYPE_Data);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    do {
        UpnpStateVariable * _DiscoveredServices = UpnpStateVariable_New();
        if (_DiscoveredServices == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpStateVariable_Initialize(_DiscoveredServices, PROPERTY_DiscoveredServices, "string", NULL, "YES");
        if (RET_FAILED(ret)) {
            break;
        }

        ret = UpnpService_AddStateVariable(service, _DiscoveredServices);
        if (RET_FAILED(ret)) {
            break;
        }
    } while (0);

    return ret;
}

static TinyRet init_actionList(UpnpService *service) {
    TinyRet ret = TINY_RET_OK;

    /**
    * StartScan
    */
    do {
        UpnpAction * _StartScan = NULL;
        UpnpArgument * _Fileter = NULL;
        _StartScan = UpnpAction_New();
        if (_StartScan == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_StartScan, ACTION_StartScan);
        if (RET_FAILED(ret)) {
            break;
        }

        _Fileter = UpnpArgument_New(_StartScan_ARG_Fileter, ARG_IN, PROPERTY_A_ARG_TYPE_Filter);
        if (_Fileter == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_StartScan, _Fileter);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _StartScan);
    } while (0);

    /**
    * WriteCharacteristic
    */
    do {
        UpnpAction * _WriteCharacteristic = NULL;
        UpnpArgument * _BleDevice = NULL;
        UpnpArgument * _BleService = NULL;
        UpnpArgument * _BleCharacteristic = NULL;
        UpnpArgument * _Data = NULL;
        _WriteCharacteristic = UpnpAction_New();
        if (_WriteCharacteristic == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_WriteCharacteristic, ACTION_WriteCharacteristic);
        if (RET_FAILED(ret)) {
            break;
        }

        _BleDevice = UpnpArgument_New(_WriteCharacteristic_ARG_BleDevice, ARG_IN, PROPERTY_A_ARG_TYPE_BleDevice);
        if (_BleDevice == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_WriteCharacteristic, _BleDevice);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _WriteCharacteristic);
        _BleService = UpnpArgument_New(_WriteCharacteristic_ARG_BleService, ARG_IN, PROPERTY_A_ARG_TYPE_BleService);
        if (_BleService == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_WriteCharacteristic, _BleService);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _WriteCharacteristic);
        _BleCharacteristic = UpnpArgument_New(_WriteCharacteristic_ARG_BleCharacteristic, ARG_IN, PROPERTY_A_ARG_TYPE_BleCharacteristic);
        if (_BleCharacteristic == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_WriteCharacteristic, _BleCharacteristic);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _WriteCharacteristic);
        _Data = UpnpArgument_New(_WriteCharacteristic_ARG_Data, ARG_IN, PROPERTY_A_ARG_TYPE_Data);
        if (_Data == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_WriteCharacteristic, _Data);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _WriteCharacteristic);
    } while (0);

    /**
    * KeepAlive
    */
    do {
        UpnpAction * _KeepAlive = NULL;
        UpnpArgument * _BleDevice = NULL;
        _KeepAlive = UpnpAction_New();
        if (_KeepAlive == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_KeepAlive, ACTION_KeepAlive);
        if (RET_FAILED(ret)) {
            break;
        }

        _BleDevice = UpnpArgument_New(_KeepAlive_ARG_BleDevice, ARG_IN, PROPERTY_A_ARG_TYPE_BleDevice);
        if (_BleDevice == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_KeepAlive, _BleDevice);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _KeepAlive);
    } while (0);

    /**
    * DiscoverServices
    */
    do {
        UpnpAction * _DiscoverServices = NULL;
        UpnpArgument * _BleDevice = NULL;
        _DiscoverServices = UpnpAction_New();
        if (_DiscoverServices == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_DiscoverServices, ACTION_DiscoverServices);
        if (RET_FAILED(ret)) {
            break;
        }

        _BleDevice = UpnpArgument_New(_DiscoverServices_ARG_BleDevice, ARG_IN, PROPERTY_A_ARG_TYPE_BleDevice);
        if (_BleDevice == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_DiscoverServices, _BleDevice);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _DiscoverServices);
    } while (0);

    /**
    * EnableCharacteristicNotification
    */
    do {
        UpnpAction * _EnableCharacteristicNotification = NULL;
        UpnpArgument * _BleDevice = NULL;
        UpnpArgument * _BleService = NULL;
        UpnpArgument * _BleCharacteristic = NULL;
        _EnableCharacteristicNotification = UpnpAction_New();
        if (_EnableCharacteristicNotification == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_EnableCharacteristicNotification, ACTION_EnableCharacteristicNotification);
        if (RET_FAILED(ret)) {
            break;
        }

        _BleDevice = UpnpArgument_New(_EnableCharacteristicNotification_ARG_BleDevice, ARG_IN, PROPERTY_A_ARG_TYPE_BleDevice);
        if (_BleDevice == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_EnableCharacteristicNotification, _BleDevice);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _EnableCharacteristicNotification);
        _BleService = UpnpArgument_New(_EnableCharacteristicNotification_ARG_BleService, ARG_IN, PROPERTY_A_ARG_TYPE_BleService);
        if (_BleService == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_EnableCharacteristicNotification, _BleService);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _EnableCharacteristicNotification);
        _BleCharacteristic = UpnpArgument_New(_EnableCharacteristicNotification_ARG_BleCharacteristic, ARG_IN, PROPERTY_A_ARG_TYPE_BleCharacteristic);
        if (_BleCharacteristic == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_EnableCharacteristicNotification, _BleCharacteristic);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _EnableCharacteristicNotification);
    } while (0);

    /**
    * ReadCharacteristic
    */
    do {
        UpnpAction * _ReadCharacteristic = NULL;
        UpnpArgument * _BleDevice = NULL;
        UpnpArgument * _BleService = NULL;
        UpnpArgument * _BleCharacteristic = NULL;
        _ReadCharacteristic = UpnpAction_New();
        if (_ReadCharacteristic == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_ReadCharacteristic, ACTION_ReadCharacteristic);
        if (RET_FAILED(ret)) {
            break;
        }

        _BleDevice = UpnpArgument_New(_ReadCharacteristic_ARG_BleDevice, ARG_IN, PROPERTY_A_ARG_TYPE_BleDevice);
        if (_BleDevice == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_ReadCharacteristic, _BleDevice);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _ReadCharacteristic);
        _BleService = UpnpArgument_New(_ReadCharacteristic_ARG_BleService, ARG_IN, PROPERTY_A_ARG_TYPE_BleService);
        if (_BleService == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_ReadCharacteristic, _BleService);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _ReadCharacteristic);
        _BleCharacteristic = UpnpArgument_New(_ReadCharacteristic_ARG_BleCharacteristic, ARG_IN, PROPERTY_A_ARG_TYPE_BleCharacteristic);
        if (_BleCharacteristic == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_ReadCharacteristic, _BleCharacteristic);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _ReadCharacteristic);
    } while (0);

    /**
    * getConnectedDevices
    */
    do {
        UpnpAction * _getConnectedDevices = NULL;
        UpnpArgument * _RetAvaliableDevices = NULL;
        _getConnectedDevices = UpnpAction_New();
        if (_getConnectedDevices == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_getConnectedDevices, ACTION_getConnectedDevices);
        if (RET_FAILED(ret)) {
            break;
        }

        _RetAvaliableDevices = UpnpArgument_New(_getConnectedDevices_ARG_RetAvaliableDevices, ARG_OUT, PROPERTY_A_ARG_TYPE_BleDevices);
        if (_RetAvaliableDevices == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_getConnectedDevices, _RetAvaliableDevices);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _getConnectedDevices);
    } while (0);

    /**
    * getAvaliableDevices
    */
    do {
        UpnpAction * _getAvaliableDevices = NULL;
        UpnpArgument * _RetAvaliableDevices = NULL;
        _getAvaliableDevices = UpnpAction_New();
        if (_getAvaliableDevices == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_getAvaliableDevices, ACTION_getAvaliableDevices);
        if (RET_FAILED(ret)) {
            break;
        }

        _RetAvaliableDevices = UpnpArgument_New(_getAvaliableDevices_ARG_RetAvaliableDevices, ARG_OUT, PROPERTY_A_ARG_TYPE_BleDevices);
        if (_RetAvaliableDevices == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_getAvaliableDevices, _RetAvaliableDevices);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _getAvaliableDevices);
    } while (0);

    /**
    * StopScan
    */
    do {
        UpnpAction * _StopScan = NULL;
        _StopScan = UpnpAction_New();
        if (_StopScan == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_StopScan, ACTION_StopScan);
        if (RET_FAILED(ret)) {
            break;
        }

    } while (0);

    /**
    * DisableCharacteristicNotification
    */
    do {
        UpnpAction * _DisableCharacteristicNotification = NULL;
        UpnpArgument * _BleDevice = NULL;
        UpnpArgument * _BleService = NULL;
        UpnpArgument * _BleCharacteristic = NULL;
        _DisableCharacteristicNotification = UpnpAction_New();
        if (_DisableCharacteristicNotification == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_SetName(_DisableCharacteristicNotification, ACTION_DisableCharacteristicNotification);
        if (RET_FAILED(ret)) {
            break;
        }

        _BleDevice = UpnpArgument_New(_DisableCharacteristicNotification_ARG_BleDevice, ARG_IN, PROPERTY_A_ARG_TYPE_BleDevice);
        if (_BleDevice == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_DisableCharacteristicNotification, _BleDevice);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _DisableCharacteristicNotification);
        _BleService = UpnpArgument_New(_DisableCharacteristicNotification_ARG_BleService, ARG_IN, PROPERTY_A_ARG_TYPE_BleService);
        if (_BleService == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_DisableCharacteristicNotification, _BleService);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _DisableCharacteristicNotification);
        _BleCharacteristic = UpnpArgument_New(_DisableCharacteristicNotification_ARG_BleCharacteristic, ARG_IN, PROPERTY_A_ARG_TYPE_BleCharacteristic);
        if (_BleCharacteristic == NULL) {
            ret = TINY_RET_E_NEW;
            break;
        }

        ret = UpnpAction_AddArgument(_DisableCharacteristicNotification, _BleCharacteristic);
        if (RET_FAILED(ret)) {
            break;
        }

        UpnpService_AddAction(service, _DisableCharacteristicNotification);
    } while (0);

    return ret;
}

bool BleOperation_IsImplemented(BleOperation *thiz, UpnpService *service) {
    RETURN_VAL_IF_FAIL(thiz, false);
    RETURN_VAL_IF_FAIL(service, false);

    return STR_EQUAL(UpnpService_GetServiceType(service), _SERVICE_TYPE);
}

TinyRet BleOperation_SetHandler(BleOperation *thiz, BleOperation_ActionHandler *handler, void *ctx) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    thiz->OnStartScan = handler->OnStartScan;
    thiz->OnWriteCharacteristic = handler->OnWriteCharacteristic;
    thiz->OnKeepAlive = handler->OnKeepAlive;
    thiz->OnDiscoverServices = handler->OnDiscoverServices;
    thiz->OnEnableCharacteristicNotification = handler->OnEnableCharacteristicNotification;
    thiz->OnReadCharacteristic = handler->OnReadCharacteristic;
    thiz->OngetConnectedDevices = handler->OngetConnectedDevices;
    thiz->OngetAvaliableDevices = handler->OngetAvaliableDevices;
    thiz->OnStopScan = handler->OnStopScan;
    thiz->OnDisableCharacteristicNotification = handler->OnDisableCharacteristicNotification;
    thiz->ctx = ctx;

    return ret;
}

UpnpCode BleOperation_OnAction(BleOperation *thiz, UpnpAction *action) {
    const char *actionName = NULL;

    RETURN_VAL_IF_FAIL(thiz, UPNP_ERR_INVALID_ARGS);
    RETURN_VAL_IF_FAIL(action, UPNP_ERR_INVALID_ARGS);

    actionName = UpnpAction_GetName(action);
    LOG_D(TAG, "BleOperation_OnAction: %s", actionName);

    if (STR_EQUAL(actionName, ACTION_StartScan)) {
        return handle_StartScan(thiz, action);
    }

    if (STR_EQUAL(actionName, ACTION_WriteCharacteristic)) {
        return handle_WriteCharacteristic(thiz, action);
    }

    if (STR_EQUAL(actionName, ACTION_KeepAlive)) {
        return handle_KeepAlive(thiz, action);
    }

    if (STR_EQUAL(actionName, ACTION_DiscoverServices)) {
        return handle_DiscoverServices(thiz, action);
    }

    if (STR_EQUAL(actionName, ACTION_EnableCharacteristicNotification)) {
        return handle_EnableCharacteristicNotification(thiz, action);
    }

    if (STR_EQUAL(actionName, ACTION_ReadCharacteristic)) {
        return handle_ReadCharacteristic(thiz, action);
    }

    if (STR_EQUAL(actionName, ACTION_getConnectedDevices)) {
        return handle_getConnectedDevices(thiz, action);
    }

    if (STR_EQUAL(actionName, ACTION_getAvaliableDevices)) {
        return handle_getAvaliableDevices(thiz, action);
    }

    if (STR_EQUAL(actionName, ACTION_StopScan)) {
        return handle_StopScan(thiz, action);
    }

    if (STR_EQUAL(actionName, ACTION_DisableCharacteristicNotification)) {
        return handle_DisableCharacteristicNotification(thiz, action);
    }

    return UPNP_ERR_ACTION_FAILED;
}

TinyRet BleOperation_SendEvents(BleOperation *thiz) {
    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    return UpnpService_SendEvents(thiz->service);
}

TinyRet BleOperation_SetCharacteristicReaded(BleOperation *thiz, char * theCharacteristicReaded) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _CharacteristicReaded = UpnpService_GetStateVariable(thiz->service, PROPERTY_CharacteristicReaded);
        if (_CharacteristicReaded == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_CharacteristicReaded);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_CharacteristicReaded->value.internalValue.stringValue != theCharacteristicReaded) {
            _CharacteristicReaded->value.internalValue.stringValue = theCharacteristicReaded;
            _CharacteristicReaded->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetA_ARG_TYPE_BleCharacteristic(BleOperation *thiz, char * theA_ARG_TYPE_BleCharacteristic) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _A_ARG_TYPE_BleCharacteristic = UpnpService_GetStateVariable(thiz->service, PROPERTY_A_ARG_TYPE_BleCharacteristic);
        if (_A_ARG_TYPE_BleCharacteristic == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_A_ARG_TYPE_BleCharacteristic);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_A_ARG_TYPE_BleCharacteristic->value.internalValue.stringValue != theA_ARG_TYPE_BleCharacteristic) {
            _A_ARG_TYPE_BleCharacteristic->value.internalValue.stringValue = theA_ARG_TYPE_BleCharacteristic;
            _A_ARG_TYPE_BleCharacteristic->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetA_ARG_TYPE_BleService(BleOperation *thiz, char * theA_ARG_TYPE_BleService) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _A_ARG_TYPE_BleService = UpnpService_GetStateVariable(thiz->service, PROPERTY_A_ARG_TYPE_BleService);
        if (_A_ARG_TYPE_BleService == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_A_ARG_TYPE_BleService);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_A_ARG_TYPE_BleService->value.internalValue.stringValue != theA_ARG_TYPE_BleService) {
            _A_ARG_TYPE_BleService->value.internalValue.stringValue = theA_ARG_TYPE_BleService;
            _A_ARG_TYPE_BleService->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetA_ARG_TYPE_BleDevices(BleOperation *thiz, char * theA_ARG_TYPE_BleDevices) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _A_ARG_TYPE_BleDevices = UpnpService_GetStateVariable(thiz->service, PROPERTY_A_ARG_TYPE_BleDevices);
        if (_A_ARG_TYPE_BleDevices == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_A_ARG_TYPE_BleDevices);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_A_ARG_TYPE_BleDevices->value.internalValue.stringValue != theA_ARG_TYPE_BleDevices) {
            _A_ARG_TYPE_BleDevices->value.internalValue.stringValue = theA_ARG_TYPE_BleDevices;
            _A_ARG_TYPE_BleDevices->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetScanResult(BleOperation *thiz, char * theScanResult) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _ScanResult = UpnpService_GetStateVariable(thiz->service, PROPERTY_ScanResult);
        if (_ScanResult == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_ScanResult);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_ScanResult->value.internalValue.stringValue != theScanResult) {
            _ScanResult->value.internalValue.stringValue = theScanResult;
            _ScanResult->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetCharacteristicNotified(BleOperation *thiz, char * theCharacteristicNotified) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _CharacteristicNotified = UpnpService_GetStateVariable(thiz->service, PROPERTY_CharacteristicNotified);
        if (_CharacteristicNotified == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_CharacteristicNotified);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_CharacteristicNotified->value.internalValue.stringValue != theCharacteristicNotified) {
            _CharacteristicNotified->value.internalValue.stringValue = theCharacteristicNotified;
            _CharacteristicNotified->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetA_ARG_TYPE_BleDevice(BleOperation *thiz, char * theA_ARG_TYPE_BleDevice) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _A_ARG_TYPE_BleDevice = UpnpService_GetStateVariable(thiz->service, PROPERTY_A_ARG_TYPE_BleDevice);
        if (_A_ARG_TYPE_BleDevice == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_A_ARG_TYPE_BleDevice);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_A_ARG_TYPE_BleDevice->value.internalValue.stringValue != theA_ARG_TYPE_BleDevice) {
            _A_ARG_TYPE_BleDevice->value.internalValue.stringValue = theA_ARG_TYPE_BleDevice;
            _A_ARG_TYPE_BleDevice->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetA_ARG_TYPE_Filter(BleOperation *thiz, char * theA_ARG_TYPE_Filter) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _A_ARG_TYPE_Filter = UpnpService_GetStateVariable(thiz->service, PROPERTY_A_ARG_TYPE_Filter);
        if (_A_ARG_TYPE_Filter == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_A_ARG_TYPE_Filter);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_A_ARG_TYPE_Filter->value.internalValue.stringValue != theA_ARG_TYPE_Filter) {
            _A_ARG_TYPE_Filter->value.internalValue.stringValue = theA_ARG_TYPE_Filter;
            _A_ARG_TYPE_Filter->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetCharacteristicWrited(BleOperation *thiz, char * theCharacteristicWrited) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _CharacteristicWrited = UpnpService_GetStateVariable(thiz->service, PROPERTY_CharacteristicWrited);
        if (_CharacteristicWrited == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_CharacteristicWrited);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_CharacteristicWrited->value.internalValue.stringValue != theCharacteristicWrited) {
            _CharacteristicWrited->value.internalValue.stringValue = theCharacteristicWrited;
            _CharacteristicWrited->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetA_ARG_TYPE_Data(BleOperation *thiz, char * theA_ARG_TYPE_Data) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _A_ARG_TYPE_Data = UpnpService_GetStateVariable(thiz->service, PROPERTY_A_ARG_TYPE_Data);
        if (_A_ARG_TYPE_Data == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_A_ARG_TYPE_Data);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_A_ARG_TYPE_Data->value.internalValue.stringValue != theA_ARG_TYPE_Data) {
            _A_ARG_TYPE_Data->value.internalValue.stringValue = theA_ARG_TYPE_Data;
            _A_ARG_TYPE_Data->isChanged = true;
        }
    } while (0);

    return ret;
}

TinyRet BleOperation_SetDiscoveredServices(BleOperation *thiz, char * theDiscoveredServices) {
    TinyRet ret = TINY_RET_OK;

    RETURN_VAL_IF_FAIL(thiz, TINY_RET_E_ARG_NULL);

    do {
        UpnpStateVariable * _DiscoveredServices = UpnpService_GetStateVariable(thiz->service, PROPERTY_DiscoveredServices);
        if (_DiscoveredServices == NULL) {
            LOG_E(TAG, "invalid: %s NOT FOUND!", PROPERTY_DiscoveredServices);
            ret = TINY_RET_E_INTERNAL;
            break;
        }

        if (_DiscoveredServices->value.internalValue.stringValue != theDiscoveredServices) {
            _DiscoveredServices->value.internalValue.stringValue = theDiscoveredServices;
            _DiscoveredServices->isChanged = true;
        }
    } while (0);

    return ret;
}

static UpnpCode handle_StartScan(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
        UpnpStateVariable * _Fileter = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _StartScan_ARG_Fileter));
	    if (_Fileter == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _StartScan_ARG_Fileter);
            break;
        }

        code = thiz->OnStartScan(thiz, _Fileter->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
    } while (0);

    return code;
}

static UpnpCode handle_WriteCharacteristic(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
        UpnpStateVariable * _BleDevice = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _WriteCharacteristic_ARG_BleDevice));
	    if (_BleDevice == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _WriteCharacteristic_ARG_BleDevice);
            break;
        }

        code = thiz->OnWriteCharacteristic(thiz, _BleDevice->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
        UpnpStateVariable * _BleService = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _WriteCharacteristic_ARG_BleService));
	    if (_BleService == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _WriteCharacteristic_ARG_BleService);
            break;
        }

        code = thiz->OnWriteCharacteristic(thiz, _BleService->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
        UpnpStateVariable * _BleCharacteristic = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _WriteCharacteristic_ARG_BleCharacteristic));
	    if (_BleCharacteristic == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _WriteCharacteristic_ARG_BleCharacteristic);
            break;
        }

        code = thiz->OnWriteCharacteristic(thiz, _BleCharacteristic->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
        UpnpStateVariable * _Data = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _WriteCharacteristic_ARG_Data));
	    if (_Data == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _WriteCharacteristic_ARG_Data);
            break;
        }

        code = thiz->OnWriteCharacteristic(thiz, _Data->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
    } while (0);

    return code;
}

static UpnpCode handle_KeepAlive(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
        UpnpStateVariable * _BleDevice = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _KeepAlive_ARG_BleDevice));
	    if (_BleDevice == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _KeepAlive_ARG_BleDevice);
            break;
        }

        code = thiz->OnKeepAlive(thiz, _BleDevice->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
    } while (0);

    return code;
}

static UpnpCode handle_DiscoverServices(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
        UpnpStateVariable * _BleDevice = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _DiscoverServices_ARG_BleDevice));
	    if (_BleDevice == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _DiscoverServices_ARG_BleDevice);
            break;
        }

        code = thiz->OnDiscoverServices(thiz, _BleDevice->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
    } while (0);

    return code;
}

static UpnpCode handle_EnableCharacteristicNotification(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
        UpnpStateVariable * _BleDevice = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _EnableCharacteristicNotification_ARG_BleDevice));
	    if (_BleDevice == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _EnableCharacteristicNotification_ARG_BleDevice);
            break;
        }

        code = thiz->OnEnableCharacteristicNotification(thiz, _BleDevice->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
        UpnpStateVariable * _BleService = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _EnableCharacteristicNotification_ARG_BleService));
	    if (_BleService == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _EnableCharacteristicNotification_ARG_BleService);
            break;
        }

        code = thiz->OnEnableCharacteristicNotification(thiz, _BleService->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
        UpnpStateVariable * _BleCharacteristic = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _EnableCharacteristicNotification_ARG_BleCharacteristic));
	    if (_BleCharacteristic == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _EnableCharacteristicNotification_ARG_BleCharacteristic);
            break;
        }

        code = thiz->OnEnableCharacteristicNotification(thiz, _BleCharacteristic->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
    } while (0);

    return code;
}

static UpnpCode handle_ReadCharacteristic(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
        UpnpStateVariable * _BleDevice = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _ReadCharacteristic_ARG_BleDevice));
	    if (_BleDevice == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _ReadCharacteristic_ARG_BleDevice);
            break;
        }

        code = thiz->OnReadCharacteristic(thiz, _BleDevice->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
        UpnpStateVariable * _BleService = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _ReadCharacteristic_ARG_BleService));
	    if (_BleService == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _ReadCharacteristic_ARG_BleService);
            break;
        }

        code = thiz->OnReadCharacteristic(thiz, _BleService->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
        UpnpStateVariable * _BleCharacteristic = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _ReadCharacteristic_ARG_BleCharacteristic));
	    if (_BleCharacteristic == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _ReadCharacteristic_ARG_BleCharacteristic);
            break;
        }

        code = thiz->OnReadCharacteristic(thiz, _BleCharacteristic->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
    } while (0);

    return code;
}

static UpnpCode handle_getConnectedDevices(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
        BleOperation_getConnectedDevicesResult result;
        memset(&result, 0, sizeof(BleOperation_getConnectedDevicesResult));

        code = thiz->OngetConnectedDevices(thiz, &result, thiz->ctx);
        if (code != UPNP_SUCCESS) {
            break;
        }

        UpnpStateVariable * _RetAvaliableDevices = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _getConnectedDevices_ARG_RetAvaliableDevices));
        if (_RetAvaliableDevices == NULL) {
            LOG_E(TAG, "Result invalid: %s NOT FOUND!", _getConnectedDevices_ARG_RetAvaliableDevices);
            break;
        }

        _RetAvaliableDevices->value.internalValue.stringValue = result.theRetAvaliableDevices;
    } while (0);

    return code;
}

static UpnpCode handle_getAvaliableDevices(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
        BleOperation_getAvaliableDevicesResult result;
        memset(&result, 0, sizeof(BleOperation_getAvaliableDevicesResult));

        code = thiz->OngetAvaliableDevices(thiz, &result, thiz->ctx);
        if (code != UPNP_SUCCESS) {
            break;
        }

        UpnpStateVariable * _RetAvaliableDevices = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _getAvaliableDevices_ARG_RetAvaliableDevices));
        if (_RetAvaliableDevices == NULL) {
            LOG_E(TAG, "Result invalid: %s NOT FOUND!", _getAvaliableDevices_ARG_RetAvaliableDevices);
            break;
        }

        _RetAvaliableDevices->value.internalValue.stringValue = result.theRetAvaliableDevices;
    } while (0);

    return code;
}

static UpnpCode handle_StopScan(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
    } while (0);

    return code;
}

static UpnpCode handle_DisableCharacteristicNotification(BleOperation *thiz, UpnpAction *action) {
    UpnpCode code = UPNP_SUCCESS;

    do {
        UpnpStateVariable * _BleDevice = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _DisableCharacteristicNotification_ARG_BleDevice));
	    if (_BleDevice == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _DisableCharacteristicNotification_ARG_BleDevice);
            break;
        }

        code = thiz->OnDisableCharacteristicNotification(thiz, _BleDevice->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
        UpnpStateVariable * _BleService = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _DisableCharacteristicNotification_ARG_BleService));
	    if (_BleService == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _DisableCharacteristicNotification_ARG_BleService);
            break;
        }

        code = thiz->OnDisableCharacteristicNotification(thiz, _BleService->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
        UpnpStateVariable * _BleCharacteristic = UpnpService_GetStateVariable(thiz->service, UpnpAction_GetArgumentRelatedStateVariable(action, _DisableCharacteristicNotification_ARG_BleCharacteristic));
	    if (_BleCharacteristic == NULL) {
	        LOG_E(TAG, "argument invalid: %s NOT FOUND!", _DisableCharacteristicNotification_ARG_BleCharacteristic);
            break;
        }

        code = thiz->OnDisableCharacteristicNotification(thiz, _BleCharacteristic->value.internalValue.stringValue, thiz->ctx);
        if (code != UPNP_SUCCESS) {
	        break;
        }
    } while (0);

    return code;
}

